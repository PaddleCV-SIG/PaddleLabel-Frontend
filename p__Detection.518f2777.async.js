(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[18],{41435:function(B,L,n){"use strict";n.d(L,{Z:function(){return y}});var b=n(94663),Z=n(80112);function D(u){return Function.toString.call(u).indexOf("[native code]")!==-1}var T=n(18597);function S(u,a,s){return(0,T.Z)()?S=Reflect.construct:S=function(C,J,j){var z=[null];z.push.apply(z,J);var X=Function.bind.apply(C,z),R=new X;return j&&(0,Z.Z)(R,j.prototype),R},S.apply(null,arguments)}function y(u){var a=typeof Map=="function"?new Map:void 0;return y=function(r){if(r===null||!D(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(r))return a.get(r);a.set(r,C)}function C(){return S(r,arguments,(0,b.Z)(this).constructor)}return C.prototype=Object.create(r.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),(0,Z.Z)(C,r)},y(u)}},85024:function(B){B.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(B){B.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(B,L,n){"use strict";n.d(L,{pL:function(){return Z},oo:function(){return D}});var b=n(91220);function Z(y){var u=0;if(!y)return u;var a=(0,b.Z)(y),s;try{for(a.s();!(s=a.n()).done;){var r=s.value;!r||!r.frontendId||r.frontendId>u&&(u=r.frontendId)}}catch(C){a.e(C)}finally{a.f()}return u}function D(y){var u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return u?{r:parseInt(u[1],16),g:parseInt(u[2],16),b:parseInt(u[3],16)}:null}function T(y){var u=y.toString(16);return u.length==1?"0"+u:u}function S(y,u,a){return"#"+T(y)+T(u)+T(a)}},14836:function(B,L,n){"use strict";n.d(L,{Z:function(){return q}});var b=n(20228),Z=n(11382),D=n(54421),T=n(38272),S=n(57663),y=n(71577),u=n(91220),a=n(67294),s=n(56159),r=n.n(s),C=n(49111),J=n(19650),j=n(2824),z=n(11849),X=n(85024),R=n.n(X),_=n(63097),I=n(85893),k=function(A){var p=(0,z.Z)({},A.annotation),G=(0,a.useState)(p.invisible),W=(0,j.Z)(G,2),t=W[0],M=W[1],m=(0,a.useState)(0),P=(0,j.Z)(m,2),l=P[0],h=P[1];(0,a.useEffect)(function(){M(A.annotation.invisible)},[A.annotation.invisible]);var c=(0,I.jsxs)(T.ZP.Item,{className:"".concat(R().listItem," ").concat(A.active?R().listItemActive:""),unselectable:"on",onClick:function(){A.onClick(p)},children:[(0,I.jsxs)(J.Z,{align:"center",size:5,children:[(0,I.jsx)("a",{className:R().eye,style:{backgroundImage:t?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(f){f.stopPropagation(),M(!t),A.onAnnotationModify(p)}})," ",(0,I.jsx)("span",{className:R().annotationId,children:p.frontendId}),(0,I.jsx)("span",{className:R().labelName,children:p.label.name}),(0,I.jsx)(_.Z,{color:p.label.color})]}),(0,I.jsx)("a",{className:R().delete,onClick:function(f){f.stopPropagation();var E=new Date().getTime();E-l<300||(h(E),A.onAnnotationDelete(p))}})]});return c},V=k,Q=n(48971),i=function(A){var p=(0,Q.YB)(),G=p.formatMessage({id:"component.PPAnnotationList.annotationList"}),W=p.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),t=new Set,M=[],m=(0,u.Z)(A.annotations),P;try{for(m.s();!(P=m.n()).done;){var l=P.value;t.has(l.frontendId)||(M.push(l),t.add(l.frontendId))}}catch(h){m.e(h)}finally{m.f()}return(0,I.jsx)(Z.Z,{spinning:A.disabled,indicator:(0,I.jsx)(I.Fragment,{}),children:(0,I.jsx)(T.ZP,{className:r().labelList,size:"large",header:(0,I.jsx)("div",{className:r().listHeader,children:G}),bordered:!0,dataSource:M,renderItem:function(c){var v;return(0,I.jsx)(V,{onClick:A.disabled?function(){}:A.onAnnotationSelect,annotation:c,active:A.disabled?!1:c.frontendId==((v=A.currAnnotation)===null||v===void 0?void 0:v.frontendId),onAnnotationDelete:A.onAnnotationDelete,onAnnotationModify:A.onAnnotationModify})},footer:function(){return A.onAnnotationAdd?(0,I.jsx)("div",{children:(0,I.jsx)(y.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){A.onAnnotationAdd()},block:!0,children:W})}):(0,I.jsx)("div",{})}})})},q=i},10137:function(B,L,n){"use strict";var b=n(34669),Z=n(54458),D=n(67294),T=n(15156),S=n(85893),y=function(a){var s,r,C=(0,T.Ad)("pages.toolBar.progress");return(0,S.jsxs)("div",{className:"progress",children:[(0,S.jsx)(Z.Z,{className:"progressBar",percent:Math.ceil(a.project.finished/((s=a.task.all)===null||s===void 0?void 0:s.length)*100),status:"active",showInfo:!1})," ",(0,S.jsx)("span",{className:"progressDesc",children:"".concat(C(""),": ").concat(a.project.finished||0,"/").concat((r=a.task.all)===null||r===void 0?void 0:r.length,`
        `).concat(C("currentId"),": ").concat(a.task.currIdx==null?1:a.task.currIdx+1," ")})]})};L.Z=y},91861:function(B,L,n){"use strict";n.d(L,{Ad:function(){return T},k3:function(){return S},Vd:function(){return y},td:function(){return u}});var b=n(34792),Z=n(48086),D=40;function T(){localStorage.removeItem("history"),S([])}function S(a){var s=localStorage.getItem("history"),r=s?JSON.parse(s):{index:-1,items:[]};if(JSON.stringify(r.items[r.index])!=JSON.stringify(a)){var C=r.index>D?r.index-D:0,J=r.items.splice(C,r.index==0?1:r.index+1);r.items=J.concat([a]),r.index<=D?r.index++:r.index=D+1,localStorage.setItem("history",JSON.stringify(r))}}function y(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(!!s){if(s.index>=s.items.length-1){Z.default.error("No next history!");return}return s.index++,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}}function u(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(console.log("history",s),!s||!s.index||s.index<=1){Z.default.error("No previous history!");return}return s.index--,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}},58857:function(B,L,n){"use strict";n.r(L),n.d(L,{default:function(){return W}});var b=n(11849),Z=n(20228),D=n(11382),T=n(34792),S=n(48086),y=n(91220),u=n(2824),a=n(67294),s=n(48971),r=n(72285),C=n.n(r),J=n(8088),j=n(61541),z=n(44434),X=n(5041),R=n(57436),_=n(14836),I=n(15156),k=n(91861),V=n(65031),Q=n(57406),i=n(85893);function q(t){if(!(!t||t.length<2))return t.join(",")}function nn(t){var M,m=t.annotation;if(!m||!m.result||!m.label||!m.label.color)return(0,i.jsx)(i.Fragment,{});var P=m.result.split(","),l={xmin:parseInt(P[0]),ymin:parseInt(P[1]),xmax:P.length>=3?parseInt(P[2]):void 0,ymax:P.length>=4?parseInt(P[3]):void 0},h=m.label.color,c=(0,Q.oo)(h);if(!c)return(0,i.jsx)(i.Fragment,{});var v=((M=t.currentAnnotation)===null||M===void 0?void 0:M.frontendId)==m.frontendId,f=v?.5:.1,E=l.xmax!=null&&l.ymax!=null?(0,i.jsx)(V.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(m)},stroke:h,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:l.xmin,y:l.ymin,width:l.xmax-l.xmin,height:l.ymax-l.ymin,closed:!0,fill:"rgba(".concat(c.r,", ").concat(c.g,", ").concat(c.b,", ").concat(f,")")}):(0,i.jsx)(i.Fragment,{});function U(e){if(!e&&(l.xmax==null||l.ymax==null))return(0,i.jsx)(i.Fragment,{});var Y=function(O){var N;if(t.currentTool=="editor"){var tn=(N=t.stageRef)===null||N===void 0?void 0:N.current,g=tn.findOne(".baseImage"),H=!1,K=O.target.x();K>g.width()/2&&(K=g.width()/2,H=!0),K<-g.width()/2&&(K=-g.width()/2,H=!0);var $=O.target.y();$>g.height()/2&&($=g.height()/2,H=!0),$<-g.height()/2&&($=-g.height()/2,H=!0),H&&O.target.setPosition({x:K,y:$}),e?(l.xmin=K,l.ymin=$):(l.xmax=K,l.ymax=$);var en=(0,b.Z)((0,b.Z)({},m),{},{result:"".concat(l.xmin,",").concat(l.ymin,",").concat(l.xmax,",").concat(l.ymax)});t.onDrag(en)}};return(0,i.jsx)(V.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(m)},draggable:t.currentTool=="editor",onDragMove:Y,onDragEnd:Y,onMouseOver:function(){var O;t.currentTool=="editor"&&(O=t.stageRef)!==null&&O!==void 0&&O.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var O;(O=t.stageRef)!==null&&O!==void 0&&O.current&&(t.stageRef.current.container().style.cursor="default")},x:e?l.xmin:l.xmax,y:e?l.ymin:l.ymax,radius:5/t.scale,fill:h})}return(0,i.jsxs)(V.ZA,{children:[E,U(!0),U(!1)]},m.annotationId)}function A(t){var M=function(c,v){var f,E=q([c,v]);!E||!t.dataId||(console.log(E),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,Q.pL)(t.annotations)+1,label:t.currentLabel,labelId:(f=t.currentLabel)===null||f===void 0?void 0:f.labelId,result:E}))},m=function(c,v){var f;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((f=t.currentLabel)!==null&&f!==void 0&&f.color))){var E=t.currentAnnotation.result+",".concat(c,",").concat(v),U=(0,b.Z)((0,b.Z)({},t.currentAnnotation),{},{result:E});t.modifyAnnoByFrontendId(U)}},P=function(c){if(t.currentTool=="rectangle"){var v=c.mouseX+c.offsetX,f=c.mouseY+c.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?m(v,f):M(v,f)}},l=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:P,onMouseMove:function(){},onMouseUp:l,drawAnnotation:nn}}var p=n(10137),G=function(){var M,m=(0,a.useState)(0),P=(0,u.Z)(m,2),l=P[0],h=P[1],c=(0,I.Ad)("pages.toolBar"),v=(0,I.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(o,x){(0,k.Ad)(),(0,k.k3)({annos:x})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),h(0)},preUnsetCurr:tn},tool:{defaultTool:"mover"},recordHistory:k.k3}),f=v.tool,E=v.loading,U=v.scale,e=v.annotation,Y=v.task,F=v.data,O=v.project,N=v.label;function tn(){e.setCurr(void 0),h(0),console.log("preCurrLabelUnset"),f.setCurr("mover")}var g=function(o){console.log("setCurrentAnnotation"),e.setCurr(o),o!=null&&o.frontendId?h(o.frontendId):h(0)},H=function(o){var x=[],w=(0,y.Z)(e.all),on;try{for(w.s();!(on=w.n()).done;){var rn=on.value;rn.frontendId==o.frontendId?x.push(o):x.push(rn)}}catch(ln){w.e(ln)}finally{w.f()}g(o),e.setAll(x)};(0,a.useEffect)(function(){(0,k.Ad)()},[]);function K(){var d;(0,k.k3)({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(d=e.curr)===null||d===void 0?void 0:d.annotationId)==null?(console.log("finish",F.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),S.default.success(c("saveSuccess")),f.curr=="rectangle"&&g(void 0)))}var $={dataId:(M=F.curr)===null||M===void 0?void 0:M.dataId,currentLabel:N.curr,scale:U.curr,currentTool:f.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(o){var x=e.all.concat([o]);e.setAll(x),g(o)},onAnnotationModify:H,modifyAnnoByFrontendId:H,onMouseUp:K,frontendIdOps:{frontendId:l,setFrontendId:h}},en=A($),an={polygon:en,brush:void 0};return(0,i.jsxs)(J.Z,{className:C().det,children:[(0,i.jsxs)(z.Z,{children:[(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/rectangle.png",active:f.curr=="rectangle",onClick:function(){if(!N.curr){S.default.error(c("chooseCategoryFirst"));return}f.setCurr("rectangle"),g(void 0)},children:c("rectangle")}),(0,i.jsx)(j.Z,{active:f.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){f.setCurr("editor")},children:c("edit")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){U.change(.1)},children:c("zoomIn")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){U.change(-.1)},children:c("zoomOut")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;e.pushToBackend((o=F.curr)===null||o===void 0?void 0:o.dataId)},children:c("save")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/move.png",active:f.curr=="mover",onClick:function(){f.setCurr("mover")},children:c("move")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,k.td)();if(o){var x;e.setAll(o.annos),g(o.currAnno),e.pushToBackend((x=F.curr)===null||x===void 0?void 0:x.dataId,o.annos)}},children:c("unDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,k.Vd)();if(o){var x;e.pushToBackend((x=F.curr)===null||x===void 0?void 0:x.dataId,o.annos),g(o.currAnno)}},children:c("reDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),(0,k.k3)({annos:[]})},children:c("clearMark")})]}),(0,i.jsx)("div",{id:"dr",className:"mainStage",children:(0,i.jsxs)(D.Z,{tip:"loading",spinning:!!E.curr,children:[(0,i.jsx)("div",{className:"draw",children:(0,i.jsx)(R.Z,{scale:U.curr,annotations:e.all,currentTool:f.curr,currentAnnotation:e.curr,setCurrentAnnotation:g,onAnnotationModify:H,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:l,setFrontendId:h},imgSrc:F.imgSrc,transparency:100,onAnnotationAdd:function(o){var x=e.all.concat([o]);e.setAll(x)},drawTool:an,threshold:0})}),(0,i.jsx)("div",{className:"pblock",children:(0,i.jsx)(p.Z,{task:Y,project:O})}),(0,i.jsx)("div",{className:"prevTask",onClick:function(){!Y.prevTask()||g(void 0)}}),(0,i.jsx)("div",{className:"nextTask",onClick:function(){!Y.nextTask()||g(void 0)}})]})}),(0,i.jsx)(z.Z,{disLoc:"right",children:(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){s.m8.push("/project_overview?projectId=".concat(O.curr.projectId))},children:c("projectOverview")})}),(0,i.jsxs)("div",{className:"rightSideBar",children:[(0,i.jsx)(X.Z,{labels:N.all,activeIds:N.activeIds,onLabelSelect:N.onSelect,onLabelModify:function(){},onLabelDelete:N.remove,onLabelAdd:function(o){N.create((0,b.Z)((0,b.Z)({},o),{},{projectId:O.curr.projectId})).then(function(x){g(void 0),N.setCurr(x)})}}),(0,i.jsx)(_.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(o){o!=null&&o.delete||g(o),console.log(o)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),g(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){e.setAll(e.all.filter(function(x){return x.frontendId!=o.frontendId})),g(void 0),e.remove(o)}})]})]})},W=G}}]);
