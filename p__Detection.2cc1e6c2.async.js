(self.webpackChunkpp_label_frontend=self.webpackChunkpp_label_frontend||[]).push([[18],{41435:function(B,L,n){"use strict";n.d(L,{Z:function(){return h}});var b=n(94663),Z=n(80112);function p(u){return Function.toString.call(u).indexOf("[native code]")!==-1}var T=n(18597);function C(u,a,s){return(0,T.Z)()?C=Reflect.construct:C=function(P,J,j){var z=[null];z.push.apply(z,J);var X=Function.bind.apply(P,z),R=new X;return j&&(0,Z.Z)(R,j.prototype),R},C.apply(null,arguments)}function h(u){var a=typeof Map=="function"?new Map:void 0;return h=function(r){if(r===null||!p(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(r))return a.get(r);a.set(r,P)}function P(){return C(r,arguments,(0,b.Z)(this).constructor)}return P.prototype=Object.create(r.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),(0,Z.Z)(P,r)},h(u)}},85024:function(B){B.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(B){B.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(B){B.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(B,L,n){"use strict";n.d(L,{pL:function(){return Z},oo:function(){return p}});var b=n(91220);function Z(h){var u=0;if(!h)return u;var a=(0,b.Z)(h),s;try{for(a.s();!(s=a.n()).done;){var r=s.value;!r||!r.frontendId||r.frontendId>u&&(u=r.frontendId)}}catch(P){a.e(P)}finally{a.f()}return u}function p(h){var u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);return u?{r:parseInt(u[1],16),g:parseInt(u[2],16),b:parseInt(u[3],16)}:null}function T(h){var u=h.toString(16);return u.length==1?"0"+u:u}function C(h,u,a){return"#"+T(h)+T(u)+T(a)}},14836:function(B,L,n){"use strict";n.d(L,{Z:function(){return q}});var b=n(20228),Z=n(11382),p=n(54421),T=n(38272),C=n(57663),h=n(71577),u=n(91220),a=n(67294),s=n(56159),r=n.n(s),P=n(49111),J=n(19650),j=n(2824),z=n(11849),X=n(85024),R=n.n(X),_=n(63097),A=n(85893),k=function(y){var D=(0,z.Z)({},y.annotation),G=(0,a.useState)(D.invisible),W=(0,j.Z)(G,2),t=W[0],M=W[1],m=(0,a.useState)(0),I=(0,j.Z)(m,2),l=I[0],x=I[1];(0,a.useEffect)(function(){M(y.annotation.invisible)},[y.annotation.invisible]);var c=(0,A.jsxs)(T.ZP.Item,{className:"".concat(R().listItem," ").concat(y.active?R().listItemActive:""),unselectable:"on",onClick:function(){y.onClick(D)},children:[(0,A.jsxs)(J.Z,{align:"center",size:5,children:[(0,A.jsx)("a",{className:R().eye,style:{backgroundImage:t?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(f){f.stopPropagation(),M(!t),y.onAnnotationModify(D)}})," ",(0,A.jsx)("span",{className:R().annotationId,children:D.frontendId}),(0,A.jsx)("span",{className:R().labelName,children:D.label.name}),(0,A.jsx)(_.Z,{color:D.label.color})]}),(0,A.jsx)("a",{className:R().delete,onClick:function(f){f.stopPropagation();var E=new Date().getTime();E-l<300||(x(E),y.onAnnotationDelete(D))}})]});return c},V=k,Q=n(48971),i=function(y){var D=(0,Q.YB)(),G=D.formatMessage({id:"component.PPAnnotationList.annotationList"}),W=D.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),t=new Set,M=[],m=(0,u.Z)(y.annotations),I;try{for(m.s();!(I=m.n()).done;){var l=I.value;t.has(l.frontendId)||(M.push(l),t.add(l.frontendId))}}catch(x){m.e(x)}finally{m.f()}return(0,A.jsx)(Z.Z,{spinning:y.disabled,indicator:(0,A.jsx)(A.Fragment,{}),children:(0,A.jsx)(T.ZP,{className:r().labelList,size:"large",header:(0,A.jsx)("div",{className:r().listHeader,children:G}),bordered:!0,dataSource:M,renderItem:function(c){var v;return(0,A.jsx)(V,{onClick:y.disabled?function(){}:y.onAnnotationSelect,annotation:c,active:y.disabled?!1:c.frontendId==((v=y.currAnnotation)===null||v===void 0?void 0:v.frontendId),onAnnotationDelete:y.onAnnotationDelete,onAnnotationModify:y.onAnnotationModify})},footer:function(){return y.onAnnotationAdd?(0,A.jsx)("div",{children:(0,A.jsx)(h.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){y.onAnnotationAdd()},block:!0,children:W})}):(0,A.jsx)("div",{})}})})},q=i},10137:function(B,L,n){"use strict";var b=n(34669),Z=n(54458),p=n(67294),T=n(47704),C=n(85893),h=function(a){var s,r,P=(0,T.Ad)("pages.toolBar.progress");return(0,C.jsxs)("div",{className:"progress",children:[(0,C.jsx)(Z.Z,{className:"progressBar",percent:Math.ceil(a.project.finished/((s=a.task.all)===null||s===void 0?void 0:s.length)*100),status:"active",showInfo:!1})," ",(0,C.jsx)("span",{className:"progressDesc",children:"".concat(P(""),": ").concat(a.project.finished||0,"/").concat((r=a.task.all)===null||r===void 0?void 0:r.length,`
        `).concat(P("currentId"),": ").concat(a.task.currIdx==null?1:a.task.currIdx+1," ")})]})};L.Z=h},91861:function(B,L,n){"use strict";n.d(L,{Ad:function(){return T},k3:function(){return C},Vd:function(){return h},td:function(){return u}});var b=n(34792),Z=n(48086),p=40;function T(){localStorage.removeItem("history"),C([])}function C(a){var s=localStorage.getItem("history"),r=s?JSON.parse(s):{index:-1,items:[]};if(JSON.stringify(r.items[r.index])!=JSON.stringify(a)){var P=r.index>p?r.index-p:0,J=r.items.splice(P,r.index==0?1:r.index+1);r.items=J.concat([a]),r.index<=p?r.index++:r.index=p+1,localStorage.setItem("history",JSON.stringify(r))}}function h(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(!!s){if(s.index>=s.items.length-1){Z.default.error("No next history!");return}return s.index++,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}}function u(){var a=localStorage.getItem("history");if(!!a){var s=JSON.parse(a);if(console.log("history",s),!s||!s.index||s.index<=1){Z.default.error("No previous history!");return}return s.index--,localStorage.setItem("history",JSON.stringify(s)),s.items[s.index]}}},58857:function(B,L,n){"use strict";n.r(L),n.d(L,{default:function(){return W}});var b=n(11849),Z=n(20228),p=n(11382),T=n(34792),C=n(48086),h=n(91220),u=n(2824),a=n(67294),s=n(48971),r=n(72285),P=n.n(r),J=n(8088),j=n(61541),z=n(44434),X=n(5041),R=n(57436),_=n(14836),A=n(47704),k=n(91861),V=n(65031),Q=n(57406),i=n(85893);function q(t){if(!(!t||t.length<2))return t.join(",")}function nn(t){var M,m=t.annotation;if(!m||!m.result||!m.label||!m.label.color)return(0,i.jsx)(i.Fragment,{});var I=m.result.split(","),l={xmin:parseInt(I[0]),ymin:parseInt(I[1]),xmax:I.length>=3?parseInt(I[2]):void 0,ymax:I.length>=4?parseInt(I[3]):void 0},x=m.label.color,c=(0,Q.oo)(x);if(!c)return(0,i.jsx)(i.Fragment,{});var v=((M=t.currentAnnotation)===null||M===void 0?void 0:M.frontendId)==m.frontendId,f=v?.5:.1,E=l.xmax!=null&&l.ymax!=null?(0,i.jsx)(V.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(m)},stroke:x,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:l.xmin,y:l.ymin,width:l.xmax-l.xmin,height:l.ymax-l.ymin,closed:!0,fill:"rgba(".concat(c.r,", ").concat(c.g,", ").concat(c.b,", ").concat(f,")")}):(0,i.jsx)(i.Fragment,{});function F(e){if(!e&&(l.xmax==null||l.ymax==null))return(0,i.jsx)(i.Fragment,{});var Y=function(O){var N;if(t.currentTool=="editor"){var tn=(N=t.stageRef)===null||N===void 0?void 0:N.current,g=tn.findOne(".baseImage"),H=!1,$=O.target.x();$>g.width()/2&&($=g.width()/2,H=!0),$<-g.width()/2&&($=-g.width()/2,H=!0);var K=O.target.y();K>g.height()/2&&(K=g.height()/2,H=!0),K<-g.height()/2&&(K=-g.height()/2,H=!0),H&&O.target.setPosition({x:$,y:K}),e?(l.xmin=$,l.ymin=K):(l.xmax=$,l.ymax=K);var en=(0,b.Z)((0,b.Z)({},m),{},{result:"".concat(l.xmin,",").concat(l.ymin,",").concat(l.xmax,",").concat(l.ymax)});t.onDrag(en)}};return(0,i.jsx)(V.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(m)},draggable:t.currentTool=="editor",onDragMove:Y,onDragEnd:Y,onMouseOver:function(){var O;t.currentTool=="editor"&&(O=t.stageRef)!==null&&O!==void 0&&O.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var O;(O=t.stageRef)!==null&&O!==void 0&&O.current&&(t.stageRef.current.container().style.cursor="default")},x:e?l.xmin:l.xmax,y:e?l.ymin:l.ymax,radius:5/t.scale,fill:x})}return(0,i.jsxs)(V.ZA,{children:[E,F(!0),F(!1)]},m.annotationId)}function y(t){var M=function(c,v){var f,E=q([c,v]);!E||!t.dataId||(console.log(E),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,Q.pL)(t.annotations)+1,label:t.currentLabel,labelId:(f=t.currentLabel)===null||f===void 0?void 0:f.labelId,result:E}))},m=function(c,v){var f;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((f=t.currentLabel)!==null&&f!==void 0&&f.color))){var E=t.currentAnnotation.result+",".concat(c,",").concat(v),F=(0,b.Z)((0,b.Z)({},t.currentAnnotation),{},{result:E});t.modifyAnnoByFrontendId(F)}},I=function(c){if(t.currentTool=="rectangle"){var v=c.mouseX+c.offsetX,f=c.mouseY+c.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?m(v,f):M(v,f)}},l=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:I,onMouseMove:function(){},onMouseUp:l,drawAnnotation:nn}}var D=n(10137),G=function(){var M,m=(0,a.useState)(0),I=(0,u.Z)(m,2),l=I[0],x=I[1],c=(0,A.Ad)("pages.toolBar"),v=(0,A.$L)(a.useState,a.useEffect,{effectTrigger:{postTaskChange:function(o,S){(0,k.Ad)(),(0,k.k3)({annos:S})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),x(0)},preUnsetCurr:tn},tool:{defaultTool:"mover"}}),f=v.tool,E=v.loading,F=v.scale,e=v.annotation,Y=v.task,U=v.data,O=v.project,N=v.label;function tn(){e.setCurr(void 0),x(0),console.log("preCurrLabelUnset"),f.setCurr("mover")}var g=function(o){console.log("setCurrentAnnotation"),e.setCurr(o),o!=null&&o.frontendId?x(o.frontendId):x(0)},H=function(o){var S=[],w=(0,h.Z)(e.all),on;try{for(w.s();!(on=w.n()).done;){var rn=on.value;rn.frontendId==o.frontendId?S.push(o):S.push(rn)}}catch(ln){w.e(ln)}finally{w.f()}g(o),e.setAll(S)};(0,a.useEffect)(function(){(0,k.Ad)()},[]);function $(){var d;(0,k.k3)({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(d=e.curr)===null||d===void 0?void 0:d.annotationId)==null?(console.log("finish",U.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),C.default.success(c("saveSuccess")),f.curr=="rectangle"&&g(void 0)))}var K={dataId:(M=U.curr)===null||M===void 0?void 0:M.dataId,currentLabel:N.curr,scale:F.curr,currentTool:f.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(o){var S=e.all.concat([o]);e.setAll(S),g(o)},onAnnotationModify:H,modifyAnnoByFrontendId:H,onMouseUp:$,frontendIdOps:{frontendId:l,setFrontendId:x}},en=y(K),an={polygon:en,brush:void 0};return(0,i.jsxs)(J.Z,{className:P().det,children:[(0,i.jsxs)(z.Z,{children:[(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/rectangle.png",active:f.curr=="rectangle",onClick:function(){if(!N.curr){C.default.error(c("chooseCategoryFirst"));return}f.setCurr("rectangle"),g(void 0)},children:c("rectangle")}),(0,i.jsx)(j.Z,{active:f.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){f.setCurr("editor")},children:c("edit")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){F.change(.1)},children:c("zoomIn")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){F.change(-.1)},children:c("zoomOut")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;e.pushToBackend((o=U.curr)===null||o===void 0?void 0:o.dataId)},children:c("save")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/move.png",active:f.curr=="mover",onClick:function(){f.setCurr("mover")},children:c("move")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=(0,k.td)();if(o){var S;e.setAll(o.annos),g(o.currAnno),e.pushToBackend((S=U.curr)===null||S===void 0?void 0:S.dataId,o.annos)}},children:c("unDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=(0,k.Vd)();o&&(e.setAll(o.annos),g(o.currAnno))},children:c("reDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),(0,k.k3)({annos:[]})},children:c("clearMark")})]}),(0,i.jsx)("div",{id:"dr",className:"mainStage",children:(0,i.jsxs)(p.Z,{tip:"loading",spinning:!!E.curr,children:[(0,i.jsx)("div",{className:"draw",children:(0,i.jsx)(R.Z,{scale:F.curr,annotations:e.all,currentTool:f.curr,currentAnnotation:e.curr,setCurrentAnnotation:g,onAnnotationModify:H,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:l,setFrontendId:x},imgSrc:U.imgSrc,transparency:100,onAnnotationAdd:function(o){var S=e.all.concat([o]);e.setAll(S)},drawTool:an,threshold:0})}),(0,i.jsx)("div",{className:"pblock",children:(0,i.jsx)(D.Z,{task:Y,project:O})}),(0,i.jsx)("div",{className:"prevTask",onClick:function(){!Y.prevTask()||g(void 0)}}),(0,i.jsx)("div",{className:"nextTask",onClick:function(){!Y.nextTask()||g(void 0)}})]})}),(0,i.jsx)(z.Z,{disLoc:"right",children:(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){s.m8.push("/project_overview?projectId=".concat(O.curr.projectId))},children:c("projectOverview")})}),(0,i.jsxs)("div",{className:"rightSideBar",children:[(0,i.jsx)(X.Z,{labels:N.all,activeIds:N.activeIds,onLabelSelect:N.onSelect,onLabelModify:function(){},onLabelDelete:N.remove,onLabelAdd:function(o){N.create((0,b.Z)((0,b.Z)({},o),{},{projectId:O.curr.projectId})).then(function(S){g(void 0),N.setCurr(S)})}}),(0,i.jsx)(_.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(o){o!=null&&o.delete||g(o),console.log(o)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),g(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){e.setAll(e.all.filter(function(S){return S.frontendId!=o.frontendId})),g(void 0),e.remove(o)}})]})]})},W=G}}]);
