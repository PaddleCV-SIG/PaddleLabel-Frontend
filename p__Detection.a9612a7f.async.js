(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[18],{41435:function(E,L,n){"use strict";n.d(L,{Z:function(){return v}});var O=n(94663),b=n(80112);function D(d){return Function.toString.call(d).indexOf("[native code]")!==-1}var Z=n(18597);function A(d,o,l){return(0,Z.Z)()?A=Reflect.construct:A=function(S,$,j){var W=[null];W.push.apply(W,$);var V=Function.bind.apply(S,W),B=new V;return j&&(0,b.Z)(B,j.prototype),B},A.apply(null,arguments)}function v(d){var o=typeof Map=="function"?new Map:void 0;return v=function(a){if(a===null||!D(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o!="undefined"){if(o.has(a))return o.get(a);o.set(a,S)}function S(){return A(a,arguments,(0,O.Z)(this).constructor)}return S.prototype=Object.create(a.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),(0,b.Z)(S,a)},v(d)}},85024:function(E){E.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(E){E.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(E){E.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(E,L,n){"use strict";n.d(L,{pL:function(){return b},oo:function(){return D}});var O=n(91220);function b(v){var d=0;if(!v)return d;var o=(0,O.Z)(v),l;try{for(o.s();!(l=o.n()).done;){var a=l.value;!a||!a.frontendId||a.frontendId>d&&(d=a.frontendId)}}catch(S){o.e(S)}finally{o.f()}return d}function D(v){var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null}function Z(v){var d=v.toString(16);return d.length==1?"0"+d:d}function A(v,d,o){return"#"+Z(v)+Z(d)+Z(o)}},36505:function(E,L,n){"use strict";n.d(L,{I:function(){return D}});var O=n(48971),b=n(85893),D=function(A){var v=(0,O.YB)();return function(d){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A,l=d==null||d==""?o:o+"."+d;return(0,b.jsx)("p",{"data-test-id":l,style:{display:"inline"},children:v.formatMessage({id:l})})}}},14836:function(E,L,n){"use strict";n.d(L,{Z:function(){return nn}});var O=n(20228),b=n(11382),D=n(54421),Z=n(38272),A=n(57663),v=n(71577),d=n(91220),o=n(67294),l=n(56159),a=n.n(l),S=n(49111),$=n(19650),j=n(2824),W=n(11849),V=n(85024),B=n.n(V),q=n(63097),P=n(85893),R=function(I){var p=(0,W.Z)({},I.annotation),Q=(0,o.useState)(p.invisible),Y=(0,j.Z)(Q,2),z=Y[0],t=Y[1],M=(0,o.useState)(0),g=(0,j.Z)(M,2),C=g[0],s=g[1];(0,o.useEffect)(function(){t(I.annotation.invisible)},[I.annotation.invisible]);var x=(0,P.jsxs)(Z.ZP.Item,{className:"".concat(B().listItem," ").concat(I.active?B().listItemActive:""),unselectable:"on",onClick:function(){I.onClick(p)},children:[(0,P.jsxs)($.Z,{align:"center",size:5,children:[(0,P.jsx)("a",{className:B().eye,style:{backgroundImage:z?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(h){h.stopPropagation(),t(!z),I.onAnnotationModify(p)}})," ",(0,P.jsx)("span",{className:B().annotationId,children:p.frontendId}),(0,P.jsx)("span",{className:B().labelName,children:p.label.name}),(0,P.jsx)(q.Z,{color:p.label.color})]}),(0,P.jsx)("a",{className:B().delete,onClick:function(h){h.stopPropagation();var f=new Date().getTime();f-C<300||(s(f),I.onAnnotationDelete(p))}})]});return x},G=R,w=n(48971),i=function(I){var p=(0,w.YB)(),Q=p.formatMessage({id:"component.PPAnnotationList.annotationList"}),Y=p.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),z=new Set,t=[],M=(0,d.Z)(I.annotations),g;try{for(M.s();!(g=M.n()).done;){var C=g.value;z.has(C.frontendId)||(t.push(C),z.add(C.frontendId))}}catch(s){M.e(s)}finally{M.f()}return(0,P.jsx)(b.Z,{spinning:I.disabled,indicator:(0,P.jsx)(P.Fragment,{}),children:(0,P.jsx)(Z.ZP,{className:a().labelList,size:"large",header:(0,P.jsx)("div",{className:a().listHeader,children:Q}),bordered:!0,dataSource:t,renderItem:function(x){var c;return(0,P.jsx)(G,{onClick:I.disabled?function(){}:I.onAnnotationSelect,annotation:x,active:I.disabled?!1:x.frontendId==((c=I.currAnnotation)===null||c===void 0?void 0:c.frontendId),onAnnotationDelete:I.onAnnotationDelete,onAnnotationModify:I.onAnnotationModify})},footer:function(){return I.onAnnotationAdd?(0,P.jsx)("div",{children:(0,P.jsx)(v.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){I.onAnnotationAdd()},block:!0,children:Y})}):(0,P.jsx)("div",{})}})})},nn=i},10137:function(E,L,n){"use strict";var O=n(34669),b=n(54458),D=n(67294),Z=n(15156),A=n(85893),v=function(o){var l,a,S=(0,Z.Ad)("pages.toolBar.progress");return(0,A.jsxs)("div",{className:"progress",children:[(0,A.jsx)(b.Z,{className:"progressBar",percent:Math.ceil(o.project.finished/((l=o.task.all)===null||l===void 0?void 0:l.length)*100),status:"active",showInfo:!1})," ",(0,A.jsx)("span",{className:"progressDesc",children:"".concat(S(""),": ").concat(o.project.finished||0,"/").concat((a=o.task.all)===null||a===void 0?void 0:a.length,`
        `).concat(S("currentId"),": ").concat(o.task.currIdx==null?1:o.task.currIdx+1," ")})]})};L.Z=v},91861:function(E,L,n){"use strict";n.d(L,{Ad:function(){return Z},k3:function(){return A},Vd:function(){return v},td:function(){return d}});var O=n(34792),b=n(48086),D=40;function Z(){localStorage.removeItem("history"),A([])}function A(o){var l=localStorage.getItem("history"),a=l?JSON.parse(l):{index:-1,items:[]};if(JSON.stringify(a.items[a.index])!=JSON.stringify(o)){var S=a.index>D?a.index-D:0,$=a.items.splice(S,a.index==0?1:a.index+1);a.items=$.concat([o]),a.index<=D?a.index++:a.index=D+1,localStorage.setItem("history",JSON.stringify(a))}}function v(){var o=localStorage.getItem("history");if(!!o){var l=JSON.parse(o);if(!!l){if(l.index>=l.items.length-1){b.default.error("No next history!");return}return l.index++,localStorage.setItem("history",JSON.stringify(l)),l.items[l.index]}}}function d(){var o=localStorage.getItem("history");if(!!o){var l=JSON.parse(o);if(console.log("history",l),!l||!l.index||l.index<=1){b.default.error("No previous history!");return}return l.index--,localStorage.setItem("history",JSON.stringify(l)),l.items[l.index]}}},58857:function(E,L,n){"use strict";n.r(L),n.d(L,{default:function(){return z}});var O=n(11849),b=n(20228),D=n(11382),Z=n(34792),A=n(48086),v=n(91220),d=n(2824),o=n(67294),l=n(48971),a=n(72285),S=n.n(a),$=n(8088),j=n(61541),W=n(44434),V=n(5041),B=n(57436),q=n(14836),P=n(15156),R=n(91861),G=n(65031),w=n(57406),i=n(85893);function nn(t){if(!(!t||t.length<2))return t.join(",")}function tn(t){var M,g=t.annotation;if(!g||!g.result||!g.label||!g.label.color)return(0,i.jsx)(i.Fragment,{});var C=g.result.split(","),s={xmin:parseInt(C[0]),ymin:parseInt(C[1]),xmax:C.length>=3?parseInt(C[2]):void 0,ymax:C.length>=4?parseInt(C[3]):void 0},x=g.label.color,c=(0,w.oo)(x);if(!c)return(0,i.jsx)(i.Fragment,{});var h=((M=t.currentAnnotation)===null||M===void 0?void 0:M.frontendId)==g.frontendId,f=h?.5:.1,F=s.xmax!=null&&s.ymax!=null?(0,i.jsx)(G.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(g)},stroke:x,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:s.xmin,y:s.ymin,width:s.xmax-s.xmin,height:s.ymax-s.ymin,closed:!0,fill:"rgba(".concat(c.r,", ").concat(c.g,", ").concat(c.b,", ").concat(f,")")}):(0,i.jsx)(i.Fragment,{});function U(e){if(!e&&(s.xmax==null||s.ymax==null))return(0,i.jsx)(i.Fragment,{});var X=function(T){var N;if(t.currentTool=="editor"){var en=(N=t.stageRef)===null||N===void 0?void 0:N.current,m=en.findOne(".baseImage"),H=!1,K=T.target.x();K>m.width()/2&&(K=m.width()/2,H=!0),K<-m.width()/2&&(K=-m.width()/2,H=!0);var J=T.target.y();J>m.height()/2&&(J=m.height()/2,H=!0),J<-m.height()/2&&(J=-m.height()/2,H=!0),H&&T.target.setPosition({x:K,y:J}),e?(s.xmin=K,s.ymin=J):(s.xmax=K,s.ymax=J);var on=(0,O.Z)((0,O.Z)({},g),{},{result:"".concat(s.xmin,",").concat(s.ymin,",").concat(s.xmax,",").concat(s.ymax)});t.onDrag(on)}};return(0,i.jsx)(G.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(g)},draggable:t.currentTool=="editor",onDragMove:X,onDragEnd:X,onMouseOver:function(){var T;t.currentTool=="editor"&&(T=t.stageRef)!==null&&T!==void 0&&T.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var T;(T=t.stageRef)!==null&&T!==void 0&&T.current&&(t.stageRef.current.container().style.cursor="default")},x:e?s.xmin:s.xmax,y:e?s.ymin:s.ymax,radius:5/t.scale,fill:x})}return(0,i.jsxs)(G.ZA,{children:[F,U(!0),U(!1)]},g.annotationId)}function I(t){var M=function(c,h){var f,F=nn([c,h]);!F||!t.dataId||(console.log(F),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,w.pL)(t.annotations)+1,label:t.currentLabel,labelId:(f=t.currentLabel)===null||f===void 0?void 0:f.labelId,result:F}))},g=function(c,h){var f;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((f=t.currentLabel)!==null&&f!==void 0&&f.color))){var F=t.currentAnnotation.result+",".concat(c,",").concat(h),U=(0,O.Z)((0,O.Z)({},t.currentAnnotation),{},{result:F});t.modifyAnnoByFrontendId(U)}},C=function(c){if(t.currentTool=="rectangle"){var h=c.mouseX+c.offsetX,f=c.mouseY+c.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?g(h,f):M(h,f)}},s=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:C,onMouseMove:function(){},onMouseUp:s,drawAnnotation:tn}}var p=n(10137),Q=n(36505),Y=function(){var M,g=(0,o.useState)(0),C=(0,d.Z)(g,2),s=C[0],x=C[1],c=(0,Q.I)("pages.toolBar"),h=(0,P.$L)(o.useState,o.useEffect,{effectTrigger:{postTaskChange:function(r,y){(0,R.Ad)(),(0,R.k3)({annos:y})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),x(0)},preUnsetCurr:en},tool:{defaultTool:"mover"},recordHistory:R.k3}),f=h.tool,F=h.loading,U=h.scale,e=h.annotation,X=h.task,k=h.data,T=h.project,N=h.label;function en(){e.setCurr(void 0),x(0),console.log("preCurrLabelUnset"),f.setCurr("mover")}var m=function(r){console.log("setCurrentAnnotation"),e.setCurr(r),r!=null&&r.frontendId?x(r.frontendId):x(0)},H=function(r){var y=[],_=(0,v.Z)(e.all),rn;try{for(_.s();!(rn=_.n()).done;){var an=rn.value;an.frontendId==r.frontendId?y.push(r):y.push(an)}}catch(sn){_.e(sn)}finally{_.f()}m(r),e.setAll(y)};(0,o.useEffect)(function(){(0,R.Ad)()},[]);function K(){var u;(0,R.k3)({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(u=e.curr)===null||u===void 0?void 0:u.annotationId)==null?(console.log("finish",k.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),A.default.success(c("saveSuccess")),f.curr=="rectangle"&&m(void 0)))}var J={dataId:(M=k.curr)===null||M===void 0?void 0:M.dataId,currentLabel:N.curr,scale:U.curr,currentTool:f.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(r){var y=e.all.concat([r]);e.setAll(y),m(r)},onAnnotationModify:H,modifyAnnoByFrontendId:H,onMouseUp:K,frontendIdOps:{frontendId:s,setFrontendId:x}},on=I(J),ln={polygon:on,brush:void 0};return(0,i.jsxs)($.Z,{className:S().det,children:[(0,i.jsxs)(W.Z,{children:[(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/rectangle.png",active:f.curr=="rectangle",onClick:function(){if(!N.curr){A.default.error(c("chooseCategoryFirst"));return}f.setCurr("rectangle"),m(void 0)},children:c("rectangle")}),(0,i.jsx)(j.Z,{active:f.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){f.setCurr("editor")},children:c("edit")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){U.change(.1)},children:c("zoomIn")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){U.change(-.1)},children:c("zoomOut")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var r;e.pushToBackend((r=k.curr)===null||r===void 0?void 0:r.dataId)},children:c("save")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/move.png",active:f.curr=="mover",onClick:function(){f.setCurr("mover")},children:c("move")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var r=(0,R.td)();if(r){var y;e.setAll(r.annos),m(r.currAnno),e.pushToBackend((y=k.curr)===null||y===void 0?void 0:y.dataId,r.annos)}},children:c("unDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var r=(0,R.Vd)();if(r){var y;e.pushToBackend((y=k.curr)===null||y===void 0?void 0:y.dataId,r.annos),m(r.currAnno)}},children:c("reDo")}),(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),(0,R.k3)({annos:[]})},children:c("clearMark")})]}),(0,i.jsx)("div",{id:"dr",className:"mainStage",children:(0,i.jsxs)(D.Z,{tip:"loading",spinning:!!F.curr,children:[(0,i.jsx)("div",{className:"draw",children:(0,i.jsx)(B.Z,{scale:U.curr,annotations:e.all,currentTool:f.curr,currentAnnotation:e.curr,setCurrentAnnotation:m,onAnnotationModify:H,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:s,setFrontendId:x},imgSrc:k.imgSrc,transparency:100,onAnnotationAdd:function(r){var y=e.all.concat([r]);e.setAll(y)},drawTool:ln,threshold:0})}),(0,i.jsx)("div",{className:"pblock",children:(0,i.jsx)(p.Z,{task:X,project:T})}),(0,i.jsx)("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){!X.prevTask()||m(void 0)}}),(0,i.jsx)("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){!X.nextTask()||m(void 0)}})]})}),(0,i.jsx)(W.Z,{disLoc:"right",children:(0,i.jsx)(j.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){l.m8.push("/project_overview?projectId=".concat(T.curr.projectId))},children:c("projectOverview")})}),(0,i.jsxs)("div",{className:"rightSideBar",children:[(0,i.jsx)(V.Z,{labels:N.all,activeIds:N.activeIds,onLabelSelect:N.onSelect,onLabelModify:function(){},onLabelDelete:N.remove,onLabelAdd:function(r){N.create((0,O.Z)((0,O.Z)({},r),{},{projectId:T.curr.projectId})).then(function(y){m(void 0),N.setCurr(y)})}}),(0,i.jsx)(q.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(r){r!=null&&r.delete||m(r),console.log(r)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),m(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(r){e.setAll(e.all.filter(function(y){return y.frontendId!=r.frontendId})),m(void 0),e.remove(r)}})]})]})},z=Y}}]);
