(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[18],{41435:function(E,R,n){"use strict";n.d(R,{Z:function(){return A}});var S=n(94663),F=n(80112);function K(d){return Function.toString.call(d).indexOf("[native code]")!==-1}var D=n(18597);function b(d,l,T){return(0,D.Z)()?b=Reflect.construct:b=function(M,Y,P){var z=[null];z.push.apply(z,Y);var G=Function.bind.apply(M,z),p=new G;return P&&(0,F.Z)(p,P.prototype),p},b.apply(null,arguments)}function A(d){var l=typeof Map=="function"?new Map:void 0;return A=function(u){if(u===null||!K(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l!="undefined"){if(l.has(u))return l.get(u);l.set(u,M)}function M(){return b(u,arguments,(0,S.Z)(this).constructor)}return M.prototype=Object.create(u.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}),(0,F.Z)(M,u)},A(d)}},85024:function(E){E.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(E){E.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(E){E.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(E,R,n){"use strict";n.d(R,{pL:function(){return F},oo:function(){return K}});var S=n(91220);function F(A){var d=0;if(!A)return d;var l=(0,S.Z)(A),T;try{for(l.s();!(T=l.n()).done;){var u=T.value;!u||!u.frontendId||u.frontendId>d&&(d=u.frontendId)}}catch(M){l.e(M)}finally{l.f()}return d}function K(A){var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(A);return d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null}function D(A){var d=A.toString(16);return d.length==1?"0"+d:d}function b(A,d,l){return"#"+D(A)+D(d)+D(l)}},14836:function(E,R,n){"use strict";n.d(R,{Z:function(){return nn}});var S=n(20228),F=n(11382),K=n(54421),D=n(38272),b=n(57663),A=n(71577),d=n(91220),l=n(67294),T=n(56159),u=n.n(T),M=n(49111),Y=n(19650),P=n(2824),z=n(11849),G=n(85024),p=n.n(G),q=n(63097),I=n(85893),J=function(x){var L=(0,z.Z)({},x.annotation),Q=(0,l.useState)(L.invisible),W=(0,P.Z)(Q,2),t=W[0],C=W[1],v=(0,l.useState)(0),y=(0,P.Z)(v,2),a=y[0],m=y[1];(0,l.useEffect)(function(){C(x.annotation.invisible)},[x.annotation.invisible]);var i=(0,I.jsxs)(D.ZP.Item,{className:"".concat(p().listItem," ").concat(x.active?p().listItemActive:""),unselectable:"on",onClick:function(){x.onClick(L)},children:[(0,I.jsxs)(Y.Z,{align:"center",size:5,children:[(0,I.jsx)("a",{className:p().eye,style:{backgroundImage:t?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(c){c.stopPropagation(),C(!t),x.onAnnotationModify(L)}})," ",(0,I.jsx)("span",{className:p().annotationId,children:L.frontendId}),(0,I.jsx)("span",{className:p().labelName,children:L.label.name}),(0,I.jsx)(q.Z,{color:L.label.color})]}),(0,I.jsx)("a",{className:p().delete,onClick:function(c){c.stopPropagation();var Z=new Date().getTime();Z-a<300||(m(Z),x.onAnnotationDelete(L))}})]});return i},w=J,r=n(48971),_=function(x){var L=(0,r.YB)(),Q=L.formatMessage({id:"component.PPAnnotationList.annotationList"}),W=L.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),t=new Set,C=[],v=(0,d.Z)(x.annotations),y;try{for(v.s();!(y=v.n()).done;){var a=y.value;t.has(a.frontendId)||(C.push(a),t.add(a.frontendId))}}catch(m){v.e(m)}finally{v.f()}return(0,I.jsx)(F.Z,{spinning:x.disabled,indicator:(0,I.jsx)(I.Fragment,{}),children:(0,I.jsx)(D.ZP,{className:u().labelList,size:"large",header:(0,I.jsx)("div",{className:u().listHeader,children:Q}),bordered:!0,dataSource:C,renderItem:function(i){var f;return(0,I.jsx)(w,{onClick:x.disabled?function(){}:x.onAnnotationSelect,annotation:i,active:x.disabled?!1:i.frontendId==((f=x.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:x.onAnnotationDelete,onAnnotationModify:x.onAnnotationModify})},footer:function(){return x.onAnnotationAdd?(0,I.jsx)("div",{children:(0,I.jsx)(A.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){x.onAnnotationAdd()},block:!0,children:W})}):(0,I.jsx)("div",{})}})})},nn=_},10137:function(E,R,n){"use strict";var S=n(34669),F=n(54458),K=n(67294),D=n(15156),b=n(85893),A=function(l){var T,u,M=(0,D.Ad)("pages.toolBar.progress");return(0,b.jsxs)("div",{className:"progress",children:[(0,b.jsx)(F.Z,{className:"progressBar",percent:Math.ceil(l.project.finished/((T=l.task.all)===null||T===void 0?void 0:T.length)*100),status:"active",showInfo:!1})," ",(0,b.jsx)("span",{className:"progressDesc",children:"".concat(M(""),": ").concat(l.project.finished||0,"/").concat((u=l.task.all)===null||u===void 0?void 0:u.length,`
        `).concat(M("currentId"),": ").concat(l.task.currIdx==null?1:l.task.currIdx+1," ")})]})};R.Z=A},58857:function(E,R,n){"use strict";n.r(R),n.d(R,{default:function(){return W}});var S=n(11849),F=n(20228),K=n(11382),D=n(34792),b=n(48086),A=n(91220),d=n(2824),l=n(67294),T=n(48971),u=n(72285),M=n.n(u),Y=n(8088),P=n(61541),z=n(44434),G=n(5041),p=n(57436),q=n(14836),I=n(15156),J=n(65031),w=n(57406),r=n(85893);function _(t){if(!(!t||t.length<2))return t.join(",")}function nn(t){var C,v=t.annotation;if(!v||!v.result||!v.label||!v.label.color)return(0,r.jsx)(r.Fragment,{});var y=v.result.split(","),a={xmin:parseInt(y[0]),ymin:parseInt(y[1]),xmax:y.length>=3?parseInt(y[2]):void 0,ymax:y.length>=4?parseInt(y[3]):void 0},m=v.label.color,i=(0,w.oo)(m);if(!i)return(0,r.jsx)(r.Fragment,{});var f=((C=t.currentAnnotation)===null||C===void 0?void 0:C.frontendId)==v.frontendId,c=f?.5:.1,Z=a.xmax!=null&&a.ymax!=null?(0,r.jsx)(J.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(v)},stroke:m,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:a.xmin,y:a.ymin,width:a.xmax-a.xmin,height:a.ymax-a.ymin,closed:!0,fill:"rgba(".concat(i.r,", ").concat(i.g,", ").concat(i.b,", ").concat(c,")")}):(0,r.jsx)(r.Fragment,{});function U(e){if(!e&&(a.xmax==null||a.ymax==null))return(0,r.jsx)(r.Fragment,{});var X=function(j){var O;if(t.currentTool=="editor"){var H=(O=t.stageRef)===null||O===void 0?void 0:O.current,N=H.findOne(".baseImage"),h=!1,B=j.target.x();B>N.width()/2&&(B=N.width()/2,h=!0),B<-N.width()/2&&(B=-N.width()/2,h=!0);var $=j.target.y();$>N.height()/2&&($=N.height()/2,h=!0),$<-N.height()/2&&($=-N.height()/2,h=!0),h&&j.target.setPosition({x:B,y:$}),e?(a.xmin=B,a.ymin=$):(a.xmax=B,a.ymax=$);var en=(0,S.Z)((0,S.Z)({},v),{},{result:"".concat(a.xmin,",").concat(a.ymin,",").concat(a.xmax,",").concat(a.ymax)});t.onDrag(en)}};return(0,r.jsx)(J.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(v)},draggable:t.currentTool=="editor",onDragMove:X,onDragEnd:X,onMouseOver:function(){var j;t.currentTool=="editor"&&(j=t.stageRef)!==null&&j!==void 0&&j.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var j;(j=t.stageRef)!==null&&j!==void 0&&j.current&&(t.stageRef.current.container().style.cursor="default")},x:e?a.xmin:a.xmax,y:e?a.ymin:a.ymax,radius:5/t.scale,fill:m})}return(0,r.jsxs)(J.ZA,{children:[Z,U(!0),U(!1)]},v.annotationId)}function tn(t){var C=function(i,f){var c,Z=_([i,f]);!Z||!t.dataId||(console.log(Z),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,w.pL)(t.annotations)+1,label:t.currentLabel,labelId:(c=t.currentLabel)===null||c===void 0?void 0:c.labelId,result:Z}))},v=function(i,f){var c;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((c=t.currentLabel)!==null&&c!==void 0&&c.color))){var Z=t.currentAnnotation.result+",".concat(i,",").concat(f),U=(0,S.Z)((0,S.Z)({},t.currentAnnotation),{},{result:Z});t.modifyAnnoByFrontendId(U)}},y=function(i){if(t.currentTool=="rectangle"){var f=i.mouseX+i.offsetX,c=i.mouseY+i.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?v(f,c):C(f,c)}},a=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:y,onMouseMove:function(){},onMouseUp:a,drawAnnotation:nn}}var x=n(10137),L=n(36505),Q=function(){var C,v=(0,l.useState)(0),y=(0,d.Z)(v,2),a=y[0],m=y[1],i=(0,L.I)("pages.toolBar"),f=(0,I.$L)(l.useState,l.useEffect,{effectTrigger:{postTaskChange:function(o,g){H.init(),H.record({annos:g})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),m(0)},preUnsetCurr:N},tool:{defaultTool:"mover"}}),c=f.tool,Z=f.loading,U=f.scale,e=f.annotation,X=f.task,k=f.data,j=f.project,O=f.label,H=f.annHistory;function N(){e.setCurr(void 0),m(0),console.log("preCurrLabelUnset"),c.setCurr("mover")}var h=function(o){console.log("setCurrentAnnotation"),e.setCurr(o),o!=null&&o.frontendId?m(o.frontendId):m(0)},B=function(o){var g=[],V=(0,A.Z)(e.all),on;try{for(V.s();!(on=V.n()).done;){var rn=on.value;rn.frontendId==o.frontendId?g.push(o):g.push(rn)}}catch(cn){V.e(cn)}finally{V.f()}h(o),e.setAll(g)};(0,l.useEffect)(function(){H.init()},[]);function $(){var s;H.record({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(s=e.curr)===null||s===void 0?void 0:s.annotationId)==null?(console.log("finish",k.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),b.default.success(i("saveSuccess")),c.curr=="rectangle"&&h(void 0)))}var en={dataId:(C=k.curr)===null||C===void 0?void 0:C.dataId,currentLabel:O.curr,scale:U.curr,currentTool:c.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(o){var g=e.all.concat([o]);e.setAll(g),h(o)},onAnnotationModify:B,modifyAnnoByFrontendId:B,onMouseUp:$,frontendIdOps:{frontendId:a,setFrontendId:m}},an=tn(en),ln={polygon:an,brush:void 0};return(0,r.jsxs)(Y.Z,{className:M().det,children:[(0,r.jsxs)(z.Z,{children:[(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/rectangle.png",active:c.curr=="rectangle",onClick:function(){if(!O.curr){b.default.error(i("chooseCategoryFirst"));return}c.setCurr("rectangle"),h(void 0)},children:i("rectangle")}),(0,r.jsx)(P.Z,{active:c.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){c.setCurr("editor")},children:i("edit")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){U.change(.1)},children:i("zoomIn")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){U.change(-.1)},children:i("zoomOut")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;e.pushToBackend((o=k.curr)===null||o===void 0?void 0:o.dataId)},children:i("save")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/move.png",active:c.curr=="mover",onClick:function(){c.setCurr("mover")},children:i("move")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=H.backward();if(o){var g;e.setAll(o.annos),h(o.currAnno),e.pushToBackend((g=k.curr)===null||g===void 0?void 0:g.dataId,o.annos)}},children:i("unDo")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=H.forward();if(o){var g;e.pushToBackend((g=k.curr)===null||g===void 0?void 0:g.dataId,o.annos),h(o.currAnno)}},children:i("reDo")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),H.record({annos:[]})},children:i("clearMark")})]}),(0,r.jsx)("div",{id:"dr",className:"mainStage",children:(0,r.jsxs)(K.Z,{tip:"loading",spinning:!!Z.curr,children:[(0,r.jsx)("div",{className:"draw",children:(0,r.jsx)(p.Z,{scale:U.curr,annotations:e.all,currentTool:c.curr,currentAnnotation:e.curr,setCurrentAnnotation:h,onAnnotationModify:B,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:a,setFrontendId:m},imgSrc:k.imgSrc,transparency:100,onAnnotationAdd:function(o){var g=e.all.concat([o]);e.setAll(g)},drawTool:ln,threshold:0})}),(0,r.jsx)("div",{className:"pblock",children:(0,r.jsx)(x.Z,{task:X,project:j})}),(0,r.jsx)("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){!X.prevTask()||h(void 0)}}),(0,r.jsx)("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){!X.nextTask()||h(void 0)}})]})}),(0,r.jsx)(z.Z,{disLoc:"right",children:(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){T.m8.push("/project_overview?projectId=".concat(j.curr.projectId))},children:i("projectOverview")})}),(0,r.jsxs)("div",{className:"rightSideBar",children:[(0,r.jsx)(G.Z,{labels:O.all,activeIds:O.activeIds,onLabelSelect:O.onSelect,onLabelDelete:O.remove,onLabelAdd:function(o){O.create((0,S.Z)((0,S.Z)({},o),{},{projectId:j.curr.projectId})).then(function(g){h(void 0),O.setCurr(g)})}}),(0,r.jsx)(q.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(o){o!=null&&o.delete||h(o),console.log(o)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),h(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){e.setAll(e.all.filter(function(g){return g.frontendId!=o.frontendId})),h(void 0),e.remove(o)}})]})]})},W=Q}}]);
