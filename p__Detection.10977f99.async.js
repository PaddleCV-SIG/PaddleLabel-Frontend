(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[18],{41435:function(E,T,n){"use strict";n.d(T,{Z:function(){return x}});var L=n(94663),B=n(80112);function U(s){return Function.toString.call(s).indexOf("[native code]")!==-1}var Z=n(18597);function C(s,l,j){return(0,Z.Z)()?C=Reflect.construct:C=function(S,X,P){var z=[null];z.push.apply(z,X);var J=Function.bind.apply(S,z),R=new J;return P&&(0,B.Z)(R,P.prototype),R},C.apply(null,arguments)}function x(s){var l=typeof Map=="function"?new Map:void 0;return x=function(u){if(u===null||!U(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l!="undefined"){if(l.has(u))return l.get(u);l.set(u,S)}function S(){return C(u,arguments,(0,L.Z)(this).constructor)}return S.prototype=Object.create(u.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),(0,B.Z)(S,u)},x(s)}},85024:function(E){E.exports={listItem:"listItem___u4Q82",eye:"eye___BwaRm",delete:"delete___31JB_",roundBall:"roundBall___23A7l",popover:"popover___1BNET",annotationId:"annotationId___zAzX4",labelName:"labelName___2ohxn",listItemActive:"listItemActive___2QnA3"}},56159:function(E){E.exports={labelList:"labelList___v7C6K",listHeader:"listHeader___1aY8R",eye:"eye___2MKbp",roundBall:"roundBall___187XH"}},72285:function(E){E.exports={det:"det___3GOn8",mainStage:"mainStage___36l4G",draw:"draw___1EIyT",pblock:"pblock___107zJ",progress:"progress___vIcpV",rightSideBar:"rightSideBar___3n2bi",determinOutline:"determinOutline___1p2xS"}},57406:function(E,T,n){"use strict";n.d(T,{pL:function(){return B},oo:function(){return U}});var L=n(91220);function B(x){var s=0;if(!x)return s;var l=(0,L.Z)(x),j;try{for(l.s();!(j=l.n()).done;){var u=j.value;!u||!u.frontendId||u.frontendId>s&&(s=u.frontendId)}}catch(S){l.e(S)}finally{l.f()}return s}function U(x){var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(x);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:null}function Z(x){var s=x.toString(16);return s.length==1?"0"+s:s}function C(x,s,l){return"#"+Z(x)+Z(s)+Z(l)}},36505:function(E,T,n){"use strict";n.d(T,{I:function(){return U}});var L=n(48971),B=n(85893),U=function(C){var x=(0,L.YB)();return function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C,j=s==null||s==""?l:l+"."+s;return(0,B.jsx)("p",{"data-test-id":j,style:{display:"inline"},children:x.formatMessage({id:j})})}}},14836:function(E,T,n){"use strict";n.d(T,{Z:function(){return nn}});var L=n(20228),B=n(11382),U=n(54421),Z=n(38272),C=n(57663),x=n(71577),s=n(91220),l=n(67294),j=n(56159),u=n.n(j),S=n(49111),X=n(19650),P=n(2824),z=n(11849),J=n(85024),R=n.n(J),q=n(63097),A=n(85893),G=function(h){var O=(0,z.Z)({},h.annotation),Q=(0,l.useState)(O.invisible),W=(0,P.Z)(Q,2),t=W[0],M=W[1],v=(0,l.useState)(0),y=(0,P.Z)(v,2),a=y[0],m=y[1];(0,l.useEffect)(function(){M(h.annotation.invisible)},[h.annotation.invisible]);var i=(0,A.jsxs)(Z.ZP.Item,{className:"".concat(R().listItem," ").concat(h.active?R().listItemActive:""),unselectable:"on",onClick:function(){h.onClick(O)},children:[(0,A.jsxs)(X.Z,{align:"center",size:5,children:[(0,A.jsx)("a",{className:R().eye,style:{backgroundImage:t?"url(./pics/hide.png)":"url(./pics/show.png)"},onClick:function(d){d.stopPropagation(),M(!t),h.onAnnotationModify(O)}})," ",(0,A.jsx)("span",{className:R().annotationId,children:O.frontendId}),(0,A.jsx)("span",{className:R().labelName,children:O.label.name}),(0,A.jsx)(q.Z,{color:O.label.color})]}),(0,A.jsx)("a",{className:R().delete,onClick:function(d){d.stopPropagation();var D=new Date().getTime();D-a<300||(m(D),h.onAnnotationDelete(O))}})]});return i},V=G,r=n(48971),_=function(h){var O=(0,r.YB)(),Q=O.formatMessage({id:"component.PPAnnotationList.annotationList"}),W=O.formatMessage({id:"component.PPAnnotationList.addAnnotation"}),t=new Set,M=[],v=(0,s.Z)(h.annotations),y;try{for(v.s();!(y=v.n()).done;){var a=y.value;t.has(a.frontendId)||(M.push(a),t.add(a.frontendId))}}catch(m){v.e(m)}finally{v.f()}return(0,A.jsx)(B.Z,{spinning:h.disabled,indicator:(0,A.jsx)(A.Fragment,{}),children:(0,A.jsx)(Z.ZP,{className:u().labelList,size:"large",header:(0,A.jsx)("div",{className:u().listHeader,children:Q}),bordered:!0,dataSource:M,renderItem:function(i){var f;return(0,A.jsx)(V,{onClick:h.disabled?function(){}:h.onAnnotationSelect,annotation:i,active:h.disabled?!1:i.frontendId==((f=h.currAnnotation)===null||f===void 0?void 0:f.frontendId),onAnnotationDelete:h.onAnnotationDelete,onAnnotationModify:h.onAnnotationModify})},footer:function(){return h.onAnnotationAdd?(0,A.jsx)("div",{children:(0,A.jsx)(x.Z,{style:{height:40,fontSize:"0.75rem"},type:"primary",onClick:function(){h.onAnnotationAdd()},block:!0,children:W})}):(0,A.jsx)("div",{})}})})},nn=_},10137:function(E,T,n){"use strict";var L=n(34669),B=n(54458),U=n(67294),Z=n(15156),C=n(85893),x=function(l){var j,u,S=(0,Z.Ad)("pages.toolBar.progress");return(0,C.jsxs)("div",{className:"progress",children:[(0,C.jsx)(B.Z,{className:"progressBar",percent:Math.ceil(l.project.finished/((j=l.task.all)===null||j===void 0?void 0:j.length)*100),status:"active",showInfo:!1})," ",(0,C.jsx)("span",{className:"progressDesc",children:"".concat(S(""),": ").concat(l.project.finished||0,"/").concat((u=l.task.all)===null||u===void 0?void 0:u.length,`
        `).concat(S("currentId"),": ").concat(l.task.currIdx==null?1:l.task.currIdx+1," ")})]})};T.Z=x},58857:function(E,T,n){"use strict";n.r(T),n.d(T,{default:function(){return W}});var L=n(11849),B=n(20228),U=n(11382),Z=n(34792),C=n(48086),x=n(91220),s=n(2824),l=n(67294),j=n(48971),u=n(72285),S=n.n(u),X=n(8088),P=n(61541),z=n(44434),J=n(5041),R=n(57436),q=n(14836),A=n(15156),G=n(65031),V=n(57406),r=n(85893);function _(t){if(!(!t||t.length<2))return t.join(",")}function nn(t){var M,v=t.annotation;if(!v||!v.result||!v.label||!v.label.color)return(0,r.jsx)(r.Fragment,{});var y=v.result.split(","),a={xmin:parseInt(y[0]),ymin:parseInt(y[1]),xmax:y.length>=3?parseInt(y[2]):void 0,ymax:y.length>=4?parseInt(y[3]):void 0},m=v.label.color,i=(0,V.oo)(m);if(!i)return(0,r.jsx)(r.Fragment,{});var f=((M=t.currentAnnotation)===null||M===void 0?void 0:M.frontendId)==v.frontendId,d=f?.5:.1,D=a.xmax!=null&&a.ymax!=null?(0,r.jsx)(G.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){t.currentTool=="editor"&&t.onSelect(v)},stroke:m,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:a.xmin,y:a.ymin,width:a.xmax-a.xmin,height:a.ymax-a.ymin,closed:!0,fill:"rgba(".concat(i.r,", ").concat(i.g,", ").concat(i.b,", ").concat(d,")")}):(0,r.jsx)(r.Fragment,{});function H(e){if(!e&&(a.xmax==null||a.ymax==null))return(0,r.jsx)(r.Fragment,{});var Y=function(b){var p;if(t.currentTool=="editor"){var $=(p=t.stageRef)===null||p===void 0?void 0:p.current,F=$.findOne(".baseImage"),I=!1,N=b.target.x();N>F.width()/2&&(N=F.width()/2,I=!0),N<-F.width()/2&&(N=-F.width()/2,I=!0);var K=b.target.y();K>F.height()/2&&(K=F.height()/2,I=!0),K<-F.height()/2&&(K=-F.height()/2,I=!0),I&&b.target.setPosition({x:N,y:K}),e?(a.xmin=N,a.ymin=K):(a.xmax=N,a.ymax=K);var en=(0,L.Z)((0,L.Z)({},v),{},{result:"".concat(a.xmin,",").concat(a.ymin,",").concat(a.xmax,",").concat(a.ymax)});t.onDrag(en)}};return(0,r.jsx)(G.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(v)},draggable:t.currentTool=="editor",onDragMove:Y,onDragEnd:Y,onMouseOver:function(){var b;t.currentTool=="editor"&&(b=t.stageRef)!==null&&b!==void 0&&b.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var b;(b=t.stageRef)!==null&&b!==void 0&&b.current&&(t.stageRef.current.container().style.cursor="default")},x:e?a.xmin:a.xmax,y:e?a.ymin:a.ymax,radius:5/t.scale,fill:m})}return(0,r.jsxs)(G.ZA,{children:[D,H(!0),H(!1)]},v.annotationId)}function tn(t){var M=function(i,f){var d,D=_([i,f]);!D||!t.dataId||(console.log(D),t.onAnnotationAdd({dataId:t.dataId,type:"rectangle",frontendId:(0,V.pL)(t.annotations)+1,label:t.currentLabel,labelId:(d=t.currentLabel)===null||d===void 0?void 0:d.labelId,result:D}))},v=function(i,f){var d;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((d=t.currentLabel)!==null&&d!==void 0&&d.color))){var D=t.currentAnnotation.result+",".concat(i,",").concat(f),H=(0,L.Z)((0,L.Z)({},t.currentAnnotation),{},{result:D});t.modifyAnnoByFrontendId(H)}},y=function(i){if(t.currentTool=="rectangle"){var f=i.mouseX+i.offsetX,d=i.mouseY+i.offsetY;console.log("currentAnnotation:",t.currentAnnotation),t.currentAnnotation?v(f,d):M(f,d)}},a=function(){t.currentTool!="rectangle"&&t.currentTool!="editor"||t.onMouseUp&&t.onMouseUp()};return{onMouseDown:y,onMouseMove:function(){},onMouseUp:a,drawAnnotation:nn}}var h=n(10137),O=n(36505),Q=function(){var M,v=(0,l.useState)(0),y=(0,s.Z)(v,2),a=y[0],m=y[1],i=(0,O.I)("pages.toolBar"),f=(0,A.$L)(l.useState,l.useEffect,{effectTrigger:{postTaskChange:function(o,g){$.init(),$.record({annos:g})}},label:{oneHot:!0,postSelect:function(){e.setCurr(void 0),m(0)},preUnsetCurr:F},tool:{defaultTool:"mover"}}),d=f.tool,D=f.loading,H=f.scale,e=f.annotation,Y=f.task,k=f.data,b=f.project,p=f.label,$=f.annHistory;function F(){e.setCurr(void 0),m(0),console.log("preCurrLabelUnset"),d.setCurr("mover")}var I=function(o){console.log("setCurrentAnnotation"),e.setCurr(o),o!=null&&o.frontendId?m(o.frontendId):m(0)},N=function(o){var g=[],w=(0,x.Z)(e.all),on;try{for(w.s();!(on=w.n()).done;){var rn=on.value;rn.frontendId==o.frontendId?g.push(o):g.push(rn)}}catch(sn){w.e(sn)}finally{w.f()}I(o),e.setAll(g)};(0,l.useEffect)(function(){$.init()},[]);function K(){var c;$.record({annos:e.all,currAnno:e.curr}),console.log("finish before",e.curr),!!e.curr&&(!e.curr.result||e.curr.result.split(",").length!=4||((e==null||(c=e.curr)===null||c===void 0?void 0:c.annotationId)==null?(console.log("finish",k.curr,e.curr),e.create(e==null?void 0:e.curr)):e.update(e==null?void 0:e.curr),C.default.success(i("saveSuccess")),d.curr=="rectangle"&&I(void 0)))}var en={dataId:(M=k.curr)===null||M===void 0?void 0:M.dataId,currentLabel:p.curr,scale:H.curr,currentTool:d.curr,annotations:e.all,currentAnnotation:e.curr,onAnnotationAdd:function(o){var g=e.all.concat([o]);e.setAll(g),I(o)},onAnnotationModify:N,modifyAnnoByFrontendId:N,onMouseUp:K,frontendIdOps:{frontendId:a,setFrontendId:m}},an=tn(en),ln={polygon:an,brush:void 0};return(0,r.jsxs)(X.Z,{className:S().det,children:[(0,r.jsxs)(z.Z,{children:[(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/rectangle.png",active:d.curr=="rectangle",onClick:function(){if(!p.curr){C.default.error(i("chooseCategoryFirst"));return}d.setCurr("rectangle"),I(void 0)},children:i("rectangle")}),(0,r.jsx)(P.Z,{active:d.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){d.setCurr("editor")},children:i("edit")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){H.change(.1)},children:i("zoomIn")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){H.change(-.1)},children:i("zoomOut")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var o;e.pushToBackend((o=k.curr)===null||o===void 0?void 0:o.dataId)},children:i("save")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/move.png",active:d.curr=="mover",onClick:function(){d.setCurr("mover")},children:i("move")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){var o=$.backward();if(o){var g;e.setAll(o.annos),I(o.currAnno),e.pushToBackend((g=k.curr)===null||g===void 0?void 0:g.dataId,o.annos)}},children:i("unDo")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){var o=$.forward();if(o){var g;e.pushToBackend((g=k.curr)===null||g===void 0?void 0:g.dataId,o.annos),I(o.currAnno)}},children:i("reDo")}),(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){e.clear(),$.record({annos:[]})},children:i("clearMark")})]}),(0,r.jsx)("div",{id:"dr",className:"mainStage",children:(0,r.jsxs)(U.Z,{tip:"loading",spinning:!!D.curr,children:[(0,r.jsx)("div",{className:"draw",children:(0,r.jsx)(R.Z,{scale:H.curr,annotations:e.all,currentTool:d.curr,currentAnnotation:e.curr,setCurrentAnnotation:I,onAnnotationModify:N,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:a,setFrontendId:m},imgSrc:k.imgSrc,transparency:100,onAnnotationAdd:function(o){var g=e.all.concat([o]);e.setAll(g)},drawTool:ln,threshold:0})}),(0,r.jsx)("div",{className:"pblock",children:(0,r.jsx)(h.Z,{task:Y,project:b})}),(0,r.jsx)("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){!Y.prevTask()||I(void 0)}}),(0,r.jsx)("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){!Y.nextTask()||I(void 0)}})]})}),(0,r.jsx)(z.Z,{disLoc:"right",children:(0,r.jsx)(P.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){j.m8.push("/project_overview?projectId=".concat(b.curr.projectId))},children:i("projectOverview")})}),(0,r.jsxs)("div",{className:"rightSideBar",children:[(0,r.jsx)(J.Z,{labels:p.all,activeIds:p.activeIds,onLabelSelect:p.onSelect,onLabelModify:function(){},onLabelDelete:p.remove,onLabelAdd:function(o){p.create((0,L.Z)((0,L.Z)({},o),{},{projectId:b.curr.projectId})).then(function(g){I(void 0),p.setCurr(g)})}}),(0,r.jsx)(q.Z,{disabled:!1,currAnnotation:e.curr,annotations:e.all,onAnnotationSelect:function(o){o!=null&&o.delete||I(o),console.log(o)},onAnnotationAdd:function(){console.log("onAnnotationAdd"),I(void 0)},onAnnotationModify:function(){},onAnnotationDelete:function(o){e.setAll(e.all.filter(function(g){return g.frontendId!=o.frontendId})),I(void 0),e.remove(o)}})]})]})},W=Q}}]);
